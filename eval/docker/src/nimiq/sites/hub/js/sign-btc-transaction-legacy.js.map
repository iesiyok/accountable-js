{"version":3,"sources":["sources://./src/views/SignBtcTransaction.vue","sources://./src/views/SignBtcTransactionSuccess.vue","webpack-generated:///./src/views/SignBtcTransactionSuccess.vue?e6c8","webpack-generated:///./src/views/SignBtcTransaction.vue?44e7","webpack:///./src/views/SignBtcTransaction.vue?5ba0","webpack-generated:///./src/views/SignBtcTransactionSuccess.vue?1a82","webpack:///./src/views/SignBtcTransactionSuccess.vue?09d0","webpack-generated:///./src/views/SignBtcTransactionSuccess.vue?71ae"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AACmD;AACD;AACU;AACF;AACF;AACA;AAEZ;AAER;AAiBpC,IAAqB,kBAAkB,GAAvC,MAAqB,kBAAmB,SAAQ,gEAAmB;IAIrD,KAAK,CAAC,OAAO;QACnB,IAAI,IAAI,CAAC,OAAO,CAAC,IAAI,KAAK,mEAAW,CAAC,oBAAoB,EAAE;YACxD,IAAI,OAAO,CAAC,MAAM,IAAI,CAAC,EAAE;gBACrB,uGAAuG;gBACvG,sGAAsG;gBACtG,qGAAqG;gBACrG,4DAA4D;gBAC5D,uGAAuG;gBACvG,OAAO,CAAC,IAAI,EAAE,CAAC;aAClB;iBAAM;gBACH,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,KAAK,CAAC,sBAAsB,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;aAC1E;YACD,OAAO;SACV;QAED,MAAM,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAE,CAAC;QAE3D,IAAI,CAAC,UAAU,CAAC,OAAO,IAAI,CAAC,UAAU,CAAC,YAAY,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,QAAQ,CAAC,MAAM,EAAE;YAC7F,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,KAAK,CAAC,6CAA6C,CAAC,CAAC,CAAC;YAC3E,OAAO;SACV;QAED,MAAM,MAAM,GAA8B,EAAE,CAAC;QAC7C,IAAI,YAAkE,CAAC;QAEvE,IAAI;YACA,2GAA2G;YAC3G,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC;YAEhC,KAAK,MAAM,KAAK,IAAI,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE;gBACrC,IAAI,OAAe,CAAC;gBACpB,IAAI,KAAK,CAAC,OAAO,EAAE;oBACf,OAAO,GAAG,KAAK,CAAC,OAAO,CAAC;iBAC3B;qBAAM;oBACH,MAAM,WAAW,GAAG,MAAM,UAAU,CAAC,kBAAkB,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;oBACvE,IAAI,CAAC,WAAW,EAAE;wBACd,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,KAAK,CAAC,4BAA4B,KAAK,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;wBACzE,OAAO;qBACV;oBACD,OAAO,GAAG,WAAW,CAAC,IAAI,CAAC;iBAC9B;gBAED,MAAM,CAAC,IAAI,CAAC;oBACR,OAAO;oBACP,eAAe,EAAE,KAAK,CAAC,eAAe;oBACtC,WAAW,EAAE,KAAK,CAAC,WAAW;oBAC9B,YAAY,EAAE,KAAK,CAAC,YAAY;oBAChC,aAAa,EAAE,KAAK,CAAC,aAAa;oBAClC,KAAK,EAAE,KAAK,CAAC,KAAK;oBAClB,QAAQ,EAAE,KAAK,CAAC,QAAQ;iBAC3B,CAAC,CAAC;aACN;YAED,IAAI,IAAI,CAAC,OAAO,CAAC,YAAY,EAAE;gBAC3B,MAAM,WAAW,GAAG,MAAM,UAAU,CAAC,kBAAkB,CAAC,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC;gBAC3F,IAAI,CAAC,WAAW,EAAE;oBACd,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,KAAK,CAAC,6BAA6B,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;oBAC9F,OAAO;iBACV;gBAED,YAAY,GAAG;oBACX,OAAO,EAAE,WAAW,CAAC,IAAI;oBACzB,OAAO,EAAE,WAAW,CAAC,OAAO;oBAC5B,KAAK,EAAE,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,KAAK;iBACzC,CAAC;aACL;YAED,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC;SAChC;QAAC,OAAO,CAAC,EAAE;YACR,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC;YACvC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC,OAAO,IAAI,CAAC,CAAC;YAC5B,OAAO;SACV;QAED,IAAI,CAAC,mBAAmB,CAAC;YACrB,MAAM;YACN,YAAY;YACZ,eAAe,EAAE,IAAI,CAAC,OAAO,CAAC,MAAM;YACpC,QAAQ,EAAE,IAAI,CAAC,OAAO,CAAC,QAAQ;SAClC,EAAE,UAAU,CAAC,CAAC;IACnB,CAAC;IAES,mBAAmB,CAAC,eAAuC,EAAE,UAAsB;QACzF,sEAAsE;QAEtE,MAAM,OAAO,GAAsC;YAC/C,MAAM,EAAE,UAAU;YAClB,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,OAAO;YAE7B,GAAG,eAAe;YAElB,KAAK,EAAE,UAAU,CAAC,KAAK;YACvB,QAAQ,EAAE,UAAU,CAAC,gBAAgB;SAGxC,CAAC;QAEF,4FAA4F;QAE5F,MAAM,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,CAAC;QACpD,MAAM,CAAC,kBAAkB,CAAC,OAAO,CAAC,CAAC;IACvC,CAAC;CACJ;AAzGW;IAAP,uDAAM;mDAAqD;AACpD;IAAP,iDAAM;sDAA6D;AAFnD,kBAAkB;IADtC,wEAAS,CAAC,EAAC,UAAU,EAAE,EAAC,kFAAY,EAAE,0EAAS,EAAE,gFAAW,EAAC,EAAC,CAAC,CAAC,4CAA4C;GACxF,kBAAkB,CA0GtC;AA1GoB,iFAAkB;;;;;;;;;;;;;;;;;;ACxBiB;AAErB;AAInC,IAAqB,yBAAyB,GAA9C,MAAqB,yBAA0B,SAAQ,0DAAG;IAG9C,KAAK,CAAC,OAAO;QACjB,MAAM,MAAM,GAAyB;YACjC,YAAY,EAAE,IAAI,CAAC,cAAc,CAAC,GAAG;YACrC,IAAI,EAAE,IAAI,CAAC,cAAc,CAAC,eAAe;SAC5C,CAAC;QAEF,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;IAC9B,CAAC;CACJ;AAVU;IAAN,gDAAK;iEAAkE;AADvD,yBAAyB;IAD7C,gEAAS;GACW,yBAAyB,CAW7C;AAXoB,wFAAyB;;;;;;;;;;;;;ACT9C;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACPA;AAAA;AAAA;AAAA;AACsE;AACL;;;AAGjE;AAC0F;AAC1F,gBAAgB,2GAAU;AAC1B,EAAE,wFAAM;AACR;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,IAAI,KAAU,EAAE,YAYf;AACD;AACe,gF;;;;;;;;;;;;ACjCf;AAAA;AAAA,wCAAmS,CAAgB,qVAAG,EAAC,C;;;;;;;;;;;;ACAvT;AAAA;AAAA;AAAA;AAAwG;AAC3B;AACL;;;AAGxE;AAC0F;AAC1F,gBAAgB,2GAAU;AAC1B,EAAE,+FAAM;AACR,EAAE,oGAAM;AACR,EAAE,6GAAe;AACjB;AACA;AACA;AACA;;AAEA;;AAEA;AACA,IAAI,KAAU,EAAE,YAiBf;AACD;AACe,gF;;;;;;;;;;;;ACtCf;AAAA;AAAA,wCAA0S,CAAgB,4VAAG,EAAC,C;;;;;;;;;;;;ACA9T;AAAA;AAAA;AAAA;AAAA;AAAA","file":"js/sign-btc-transaction-legacy.js","sourcesContent":["\nimport { Component } from 'vue-property-decorator';\nimport { SmallPage } from '@nimiq/vue-components';\nimport BitcoinSyncBaseView from './BitcoinSyncBaseView.vue';\nimport StatusScreen from '../components/StatusScreen.vue';\nimport GlobalClose from '../components/GlobalClose.vue';\nimport { RequestType } from '../lib/PublicRequestTypes';\nimport { ParsedSignBtcTransactionRequest } from '../lib/RequestTypes';\nimport { Static } from '../lib/StaticStore';\nimport { WalletInfo } from '../lib/WalletInfo';\nimport { Getter } from 'vuex-class';\n\n// Import only types to avoid bundling of KeyguardClient in Ledger request if not required.\n// (But note that currently, the KeyguardClient is still always bundled in the RpcApi).\nimport type {\n    SignBtcTransactionRequest as KeyguardSignBtcTransactionRequest,\n    BitcoinTransactionInput,\n    BitcoinTransactionChangeOutput,\n    BitcoinTransactionInfo as KeyguardBitcoinTransactionInfo,\n} from '@nimiq/keyguard-client';\n\n// BitcoinTransactionInfo with complete changeOutput\nexport type BitcoinTransactionInfo = Omit<KeyguardBitcoinTransactionInfo, 'changeOutput'> & {\n    changeOutput?: Required<BitcoinTransactionChangeOutput>,\n};\n\n@Component({components: {StatusScreen, SmallPage, GlobalClose}}) // including components used in parent class\nexport default class SignBtcTransaction extends BitcoinSyncBaseView {\n    @Static protected request!: ParsedSignBtcTransactionRequest;\n    @Getter private findWallet!: (id: string) => WalletInfo | undefined;\n\n    protected async created() {\n        if (this.request.kind !== RequestType.SIGN_BTC_TRANSACTION) {\n            if (history.length >= 3) {\n                // First history entry is root, the second an original request handler invoking the transaction signing\n                // and the third is this one. If there was an original request handler calling us but the intermediate\n                // transaction signing request was lost on reload and instead the original request recovered from the\n                // RPC state, navigate back to the original request handler.\n                // TODO implementing a proper request call stack instead of the originalRouteName hack would avoid this\n                history.back();\n            } else {\n                this.$rpc.reject(new Error(`Unexpected request ${this.request.kind}`));\n            }\n            return;\n        }\n\n        const walletInfo = this.findWallet(this.request.walletId)!;\n\n        if (!walletInfo.btcXPub || !walletInfo.btcAddresses || !walletInfo.btcAddresses.external.length) {\n            this.$rpc.reject(new Error(`Account does not have any Bitcoin addresses`));\n            return;\n        }\n\n        const inputs: BitcoinTransactionInput[] = [];\n        let changeOutput: Required<BitcoinTransactionChangeOutput> | undefined;\n\n        try {\n            // Note that the sync state will only be visible in the UI if the sync is not instant (if we actually sync)\n            this.state = this.State.SYNCING;\n\n            for (const input of this.request.inputs) {\n                let keyPath: string;\n                if (input.keyPath) {\n                    keyPath = input.keyPath;\n                } else {\n                    const addressInfo = await walletInfo.findBtcAddressInfo(input.address);\n                    if (!addressInfo) {\n                        this.$rpc.reject(new Error(`Input address not found: ${input.address}`));\n                        return;\n                    }\n                    keyPath = addressInfo.path;\n                }\n\n                inputs.push({\n                    keyPath,\n                    transactionHash: input.transactionHash,\n                    outputIndex: input.outputIndex,\n                    outputScript: input.outputScript,\n                    witnessScript: input.witnessScript,\n                    value: input.value,\n                    sequence: input.sequence,\n                });\n            }\n\n            if (this.request.changeOutput) {\n                const addressInfo = await walletInfo.findBtcAddressInfo(this.request.changeOutput.address);\n                if (!addressInfo) {\n                    this.$rpc.reject(new Error(`Change address not found: ${this.request.changeOutput.address}`));\n                    return;\n                }\n\n                changeOutput = {\n                    keyPath: addressInfo.path,\n                    address: addressInfo.address,\n                    value: this.request.changeOutput.value,\n                };\n            }\n\n            this.state = this.State.NONE;\n        } catch (e) {\n            this.state = this.State.SYNCING_FAILED;\n            this.error = e.message || e;\n            return;\n        }\n\n        this._signBtcTransaction({\n            inputs,\n            changeOutput,\n            recipientOutput: this.request.output,\n            locktime: this.request.locktime,\n        }, walletInfo);\n    }\n\n    protected _signBtcTransaction(transactionInfo: BitcoinTransactionInfo, walletInfo: WalletInfo) {\n        // note that this method gets overwritten for SignBtcTransactionLedger\n\n        const request: KeyguardSignBtcTransactionRequest = {\n            layout: 'standard',\n            appName: this.request.appName,\n\n            ...transactionInfo,\n\n            keyId: walletInfo.keyId,\n            keyLabel: walletInfo.labelForKeyguard,\n\n            // flags: this.request.flags,\n        };\n\n        // staticStore.keyguardRequest = request; // Currently not used in SignBtcTransactionSuccess\n\n        const client = this.$rpc.createKeyguardClient(true);\n        client.signBtcTransaction(request);\n    }\n}\n","\n\n\nimport { Component, Vue } from 'vue-property-decorator';\nimport { SignedBtcTransaction } from '../lib/PublicRequestTypes';\nimport { State } from 'vuex-class';\nimport KeyguardClient from '@nimiq/keyguard-client';\n\n@Component\nexport default class SignBtcTransactionSuccess extends Vue {\n    @State private keyguardResult!: KeyguardClient.SignedBitcoinTransaction;\n\n    private async mounted() {\n        const result: SignedBtcTransaction = {\n            serializedTx: this.keyguardResult.raw,\n            hash: this.keyguardResult.transactionHash,\n        };\n\n        this.$rpc.resolve(result);\n    }\n}\n","var render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  return _c(\"div\")\n}\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns }","var render, staticRenderFns\nimport script from \"./SignBtcTransaction.vue?vue&type=script&lang=ts&\"\nexport * from \"./SignBtcTransaction.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"/Users/iesiyok/projects/acc-js/development/nimiq2/hub/node_modules/vue-hot-reload-api/dist/index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!api.isRecorded('6c9c55a4')) {\n      api.createRecord('6c9c55a4', component.options)\n    } else {\n      api.reload('6c9c55a4', component.options)\n    }\n    \n  }\n}\ncomponent.options.__file = \"src/views/SignBtcTransaction.vue\"\nexport default component.exports","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/ts-loader/index.js??ref--12-1!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SignBtcTransaction.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/ts-loader/index.js??ref--12-1!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SignBtcTransaction.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./SignBtcTransactionSuccess.vue?vue&type=template&id=8c8a0f22&\"\nimport script from \"./SignBtcTransactionSuccess.vue?vue&type=script&lang=ts&\"\nexport * from \"./SignBtcTransactionSuccess.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"/Users/iesiyok/projects/acc-js/development/nimiq2/hub/node_modules/vue-hot-reload-api/dist/index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!api.isRecorded('8c8a0f22')) {\n      api.createRecord('8c8a0f22', component.options)\n    } else {\n      api.reload('8c8a0f22', component.options)\n    }\n    module.hot.accept(\"./SignBtcTransactionSuccess.vue?vue&type=template&id=8c8a0f22&\", function () {\n      api.rerender('8c8a0f22', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"src/views/SignBtcTransactionSuccess.vue\"\nexport default component.exports","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/ts-loader/index.js??ref--12-1!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SignBtcTransactionSuccess.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/ts-loader/index.js??ref--12-1!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SignBtcTransactionSuccess.vue?vue&type=script&lang=ts&\"","export * from \"-!../../node_modules/cache-loader/dist/cjs.js?{\\\"cacheDirectory\\\":\\\"node_modules/.cache/vue-loader\\\",\\\"cacheIdentifier\\\":\\\"3e5283d1-vue-loader-template\\\"}!../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SignBtcTransactionSuccess.vue?vue&type=template&id=8c8a0f22&\""],"sourceRoot":""}